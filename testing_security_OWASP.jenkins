pipeline {
    agent any
    environment {
        SERVER_URL = 'chilla.pp.ua'
    }
    stage('CD to chilla dir') {
            steps {
                echo "**************** Running nmap scan ***************************"
                sh "cd /jenkins/chilla"
                echo "**************** nmap scan completed ***************************"
            }
        }
        stage('Run nmap scan') {
            steps {
                echo "**************** Running nmap scan ***************************"
                sh "nmap -sV $SERVER_URL -oN nmap_results.txt"
                echo "**************** nmap scan completed ***************************"
            }
        }

        stage('Run Nikto scan') {
            steps {
                echo "**************** Running Nikto scan ***************************"
                sh "nikto -h $SERVER_URL -o nikto_results.txt"
                echo "**************** Nikto scan completed ***************************"
            }
        }



        stage('Commit and Push security check files') {
            steps {
                echo "**************** Start commit and push txt files ***************************"
                sh '''
                    cd /jenkins/chilla
                    git add nmap_results.txt
                    git commit -m "Update nmap_results.txt"
                    git add nikto_results.txt
                    git commit -m "Update nikto_results.txt"

                    git push origin main
                '''
                echo "**************** Finish commit and push txt files ***************************"
            }
        }


}
